drop policy "Anyone can insert processed sessions" on "public"."processed_sessions";

drop policy "insert_own_subscriptions" on "public"."subscriptions";

drop policy "select_own_subscriptions" on "public"."subscriptions";

drop policy "subscriptions_select_policy" on "public"."subscriptions";

drop policy "subscriptions_update_policy" on "public"."subscriptions";

drop policy "update_own_subscriptions" on "public"."subscriptions";

drop policy "Users can create their own company info" on "public"."company_info";

drop policy "Users can delete their own company info" on "public"."company_info";

drop policy "Users can update their own company info" on "public"."company_info";

drop policy "Users can view their own company info" on "public"."company_info";

drop policy "company_profiles_user_policy" on "public"."company_profiles";

drop policy "Users can delete their own compliance items" on "public"."compliance_items";

drop policy "Users can insert their own compliance items" on "public"."compliance_items";

drop policy "Users can update their own compliance items" on "public"."compliance_items";

drop policy "Users can view their own compliance items" on "public"."compliance_items";

drop policy "Users can create their own customers" on "public"."customers";

drop policy "Users can delete their own customers" on "public"."customers";

drop policy "Users can update their own customers" on "public"."customers";

drop policy "Users can view their own customers" on "public"."customers";

drop policy "Users can delete crossings for their own trips" on "public"."driver_mileage_crossings";

drop policy "Users can insert crossings for their own trips" on "public"."driver_mileage_crossings";

drop policy "Users can update crossings for their own trips" on "public"."driver_mileage_crossings";

drop policy "Users can view crossings for their own trips" on "public"."driver_mileage_crossings";

drop policy "Users can delete their own trips" on "public"."driver_mileage_trips";

drop policy "Users can insert their own trips" on "public"."driver_mileage_trips";

drop policy "Users can update their own trips" on "public"."driver_mileage_trips";

drop policy "Users can view their own trips" on "public"."driver_mileage_trips";

drop policy "Users can create their own drivers" on "public"."drivers";

drop policy "Users can delete their own drivers" on "public"."drivers";

drop policy "Users can update their own drivers" on "public"."drivers";

drop policy "Users can view their own drivers" on "public"."drivers";

drop policy "Users can delete their own earnings" on "public"."earnings";

drop policy "Users can insert their own earnings" on "public"."earnings";

drop policy "Users can update their own earnings" on "public"."earnings";

drop policy "Users can view their own earnings" on "public"."earnings";

drop policy "Users can create their own expense categories" on "public"."expense_categories";

drop policy "Users can delete their own expense categories" on "public"."expense_categories";

drop policy "Users can update their own expense categories" on "public"."expense_categories";

drop policy "Users can view default and their own expense categories" on "public"."expense_categories";

drop policy "Users can create their own expenses" on "public"."expenses";

drop policy "Users can delete their own expenses" on "public"."expenses";

drop policy "Users can update their own expenses" on "public"."expenses";

drop policy "Users can view their own expenses" on "public"."expenses";

drop policy "Users can create their own fuel entries" on "public"."fuel_entries";

drop policy "Users can delete their own fuel entries" on "public"."fuel_entries";

drop policy "Users can update their own fuel entries" on "public"."fuel_entries";

drop policy "Users can view their own fuel entries" on "public"."fuel_entries";

drop policy "Users can create their own IFTA reports" on "public"."ifta_reports";

drop policy "Users can delete their own IFTA reports" on "public"."ifta_reports";

drop policy "Users can update their own IFTA reports" on "public"."ifta_reports";

drop policy "Users can view their own IFTA reports" on "public"."ifta_reports";

drop policy "Users can create their own IFTA trip records" on "public"."ifta_trip_records";

drop policy "Users can delete their own IFTA trip records" on "public"."ifta_trip_records";

drop policy "Users can update their own IFTA trip records" on "public"."ifta_trip_records";

drop policy "Users can view their own IFTA trip records" on "public"."ifta_trip_records";

drop policy "Users can create IFTA trip state mileage they own" on "public"."ifta_trip_state_mileage";

drop policy "Users can delete IFTA trip state mileage they own" on "public"."ifta_trip_state_mileage";

drop policy "Users can update IFTA trip state mileage they own" on "public"."ifta_trip_state_mileage";

drop policy "Users can view IFTA trip state mileage they own" on "public"."ifta_trip_state_mileage";

drop policy "Users can create invoice activities they own" on "public"."invoice_activities";

drop policy "Users can view invoice activities they own" on "public"."invoice_activities";

drop policy "Users can create invoice items they own" on "public"."invoice_items";

drop policy "Users can delete invoice items they own" on "public"."invoice_items";

drop policy "Users can update invoice items they own" on "public"."invoice_items";

drop policy "Users can view invoice items they own" on "public"."invoice_items";

drop policy "Users can create their own invoices" on "public"."invoices";

drop policy "Users can delete their own invoices" on "public"."invoices";

drop policy "Users can update their own invoices" on "public"."invoices";

drop policy "Users can view their own invoices" on "public"."invoices";

drop policy "Users can create load documents they own" on "public"."load_documents";

drop policy "Users can delete load documents they own" on "public"."load_documents";

drop policy "Users can update load documents they own" on "public"."load_documents";

drop policy "Users can view load documents they own" on "public"."load_documents";

drop policy "Users can create load stops they own" on "public"."load_stops";

drop policy "Users can delete load stops they own" on "public"."load_stops";

drop policy "Users can update load stops they own" on "public"."load_stops";

drop policy "Users can view load stops they own" on "public"."load_stops";

drop policy "Users can create their own loads" on "public"."loads";

drop policy "Users can delete their own loads" on "public"."loads";

drop policy "Users can update their own loads" on "public"."loads";

drop policy "Users can view their own loads" on "public"."loads";

drop policy "notification_preferences_user_policy" on "public"."notification_preferences";

drop policy "Users can delete their own notifications" on "public"."notifications";

drop policy "Users can update their own notifications" on "public"."notifications";

drop policy "Users can view their own notifications" on "public"."notifications";

drop policy "Users can create their own payments" on "public"."payments";

drop policy "Users can delete their own payments" on "public"."payments";

drop policy "Users can update their own payments" on "public"."payments";

drop policy "Users can view their own payments" on "public"."payments";

drop policy "Users can view their own processed sessions" on "public"."processed_sessions";

drop policy "Users can create their own reminders" on "public"."reminders";

drop policy "Users can delete their own reminders" on "public"."reminders";

drop policy "Users can update their own reminders" on "public"."reminders";

drop policy "Users can view their own reminders" on "public"."reminders";

drop policy "Service role can access all subscriptions" on "public"."subscriptions";

drop policy "Users can delete their own subscriptions" on "public"."subscriptions";

drop policy "Users can insert their own subscriptions" on "public"."subscriptions";

drop policy "Users can update their own subscriptions" on "public"."subscriptions";

drop policy "Users can view their own subscriptions" on "public"."subscriptions";

drop policy "Service role can do anything" on "public"."user_preferences";

drop policy "Users can insert their own preferences" on "public"."user_preferences";

drop policy "Users can update their own preferences" on "public"."user_preferences";

drop policy "Users can view their own preferences" on "public"."user_preferences";

drop policy "Users can create their own settings" on "public"."user_settings";

drop policy "Users can delete their own settings" on "public"."user_settings";

drop policy "Users can update their own settings" on "public"."user_settings";

drop policy "Users can view their own settings" on "public"."user_settings";

drop policy "Users can update their own profile" on "public"."users";

drop policy "Users can view their own profile" on "public"."users";

drop policy "Users can create their own vehicles" on "public"."vehicles";

drop policy "Users can delete their own vehicles" on "public"."vehicles";

drop policy "Users can update their own vehicles" on "public"."vehicles";

drop policy "Users can view their own vehicles" on "public"."vehicles";

alter table "public"."ifta_tax_rates" enable row level security;

alter table "public"."maintenance_records" enable row level security;

alter table "public"."trucks" enable row level security;

CREATE INDEX idx_company_info_user_id ON public.company_info USING btree (user_id);

CREATE INDEX idx_customers_status ON public.customers USING btree (status);

CREATE INDEX idx_customers_user_id ON public.customers USING btree (user_id);

CREATE INDEX idx_driver_mileage_trips_end_date ON public.driver_mileage_trips USING btree (end_date);

CREATE INDEX idx_driver_mileage_trips_start_date ON public.driver_mileage_trips USING btree (start_date);

CREATE INDEX idx_driver_mileage_trips_status ON public.driver_mileage_trips USING btree (status);

CREATE INDEX idx_drivers_status ON public.drivers USING btree (status);

CREATE INDEX idx_drivers_user_id ON public.drivers USING btree (user_id);

CREATE INDEX idx_earnings_user_id ON public.earnings USING btree (user_id);

CREATE INDEX idx_expenses_date ON public.expenses USING btree (date);

CREATE INDEX idx_expenses_driver_id ON public.expenses USING btree (driver_id);

CREATE INDEX idx_expenses_load_id ON public.expenses USING btree (load_id);

CREATE INDEX idx_expenses_user_id ON public.expenses USING btree (user_id);

CREATE INDEX idx_expenses_vehicle_id ON public.expenses USING btree (vehicle_id);

CREATE INDEX idx_fuel_entries_date ON public.fuel_entries USING btree (date);

CREATE INDEX idx_fuel_entries_driver_id ON public.fuel_entries USING btree (driver_id);

CREATE INDEX idx_fuel_entries_user_id ON public.fuel_entries USING btree (user_id);

CREATE INDEX idx_fuel_entries_vehicle_id ON public.fuel_entries USING btree (vehicle_id);

CREATE INDEX idx_ifta_reports_status ON public.ifta_reports USING btree (status);

CREATE INDEX idx_ifta_reports_year ON public.ifta_reports USING btree (year);

CREATE INDEX idx_ifta_trip_records_end_date ON public.ifta_trip_records USING btree (end_date);

CREATE INDEX idx_ifta_trip_records_start_date ON public.ifta_trip_records USING btree (start_date);

CREATE INDEX idx_ifta_trip_state_mileage_jurisdiction ON public.ifta_trip_state_mileage USING btree (jurisdiction);

CREATE INDEX idx_invoice_activities_invoice_id ON public.invoice_activities USING btree (invoice_id);

CREATE INDEX idx_invoice_activities_user_id ON public.invoice_activities USING btree (user_id);

CREATE INDEX idx_invoice_items_invoice_id ON public.invoice_items USING btree (invoice_id);

CREATE INDEX idx_invoices_customer_id ON public.invoices USING btree (customer_id);

CREATE INDEX idx_invoices_due_date ON public.invoices USING btree (due_date);

CREATE INDEX idx_invoices_invoice_date ON public.invoices USING btree (invoice_date);

CREATE INDEX idx_invoices_invoice_number ON public.invoices USING btree (invoice_number);

CREATE INDEX idx_invoices_load_id ON public.invoices USING btree (load_id);

CREATE INDEX idx_invoices_status ON public.invoices USING btree (status);

CREATE INDEX idx_invoices_user_id ON public.invoices USING btree (user_id);

CREATE INDEX idx_load_documents_load_id ON public.load_documents USING btree (load_id);

CREATE INDEX idx_load_documents_uploaded_by ON public.load_documents USING btree (uploaded_by);

CREATE INDEX idx_load_stops_load_id ON public.load_stops USING btree (load_id);

CREATE INDEX idx_load_stops_scheduled_date ON public.load_stops USING btree (scheduled_date);

CREATE INDEX idx_load_stops_status ON public.load_stops USING btree (status);

CREATE INDEX idx_loads_completed_by ON public.loads USING btree (completed_by);

CREATE INDEX idx_loads_customer_id ON public.loads USING btree (customer_id);

CREATE INDEX idx_loads_delivery_date ON public.loads USING btree (delivery_date);

CREATE INDEX idx_loads_driver_id ON public.loads USING btree (driver_id);

CREATE INDEX idx_loads_load_number ON public.loads USING btree (load_number);

CREATE INDEX idx_loads_pickup_date ON public.loads USING btree (pickup_date);

CREATE INDEX idx_loads_status ON public.loads USING btree (status);

CREATE INDEX idx_loads_user_id ON public.loads USING btree (user_id);

CREATE INDEX idx_loads_vehicle_id ON public.loads USING btree (vehicle_id);

CREATE INDEX idx_maintenance_records_due_date ON public.maintenance_records USING btree (due_date);

CREATE INDEX idx_maintenance_records_status ON public.maintenance_records USING btree (status);

CREATE INDEX idx_notifications_user_id ON public.notifications USING btree (user_id);

CREATE INDEX idx_payments_date ON public.payments USING btree (date);

CREATE INDEX idx_payments_invoice_id ON public.payments USING btree (invoice_id);

CREATE INDEX idx_payments_status ON public.payments USING btree (status);

CREATE INDEX idx_payments_user_id ON public.payments USING btree (user_id);

CREATE INDEX idx_reminders_completed ON public.reminders USING btree (completed);

CREATE INDEX idx_reminders_due_date ON public.reminders USING btree (due_date);

CREATE INDEX idx_reminders_user_id ON public.reminders USING btree (user_id);

CREATE INDEX idx_subscriptions_status ON public.subscriptions USING btree (status);

CREATE INDEX idx_trucks_status ON public.trucks USING btree (status);

CREATE INDEX idx_vehicles_status ON public.vehicles USING btree (status);

CREATE INDEX idx_vehicles_user_id ON public.vehicles USING btree (user_id);

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.cleanup_old_notifications()
 RETURNS integer
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM notifications
    WHERE is_read = true
        AND read_at < (CURRENT_TIMESTAMP - INTERVAL '90 days');
    GET DIAGNOSTICS deleted_count = ROW_COUNT;
    RETURN deleted_count;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.create_factored_earnings()
 RETURNS trigger
 LANGUAGE plpgsql
 SET search_path TO 'public'
AS $function$
BEGIN
  IF NEW.factored = TRUE AND (OLD.factored = FALSE OR OLD.factored IS NULL) THEN
    INSERT INTO earnings (
      user_id, load_id, amount, date, source, description, factoring_company, created_at
    ) VALUES (
      NEW.user_id, NEW.id,
      COALESCE(NEW.factored_amount, NEW.rate, 0),
      COALESCE(NEW.factored_at, NEW.completed_at, CURRENT_DATE),
      'Factoring',
      'Factored load #' || NEW.load_number || ': ' || COALESCE(NEW.origin, '') || ' to ' || COALESCE(NEW.destination, ''),
      NEW.factoring_company, NOW()
    );
  END IF;
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.create_notification(p_user_id uuid, p_title text, p_message text, p_notification_type text DEFAULT 'GENERAL_REMINDER'::text, p_entity_type text DEFAULT NULL::text, p_entity_id text DEFAULT NULL::text, p_link_to text DEFAULT NULL::text, p_due_date timestamp with time zone DEFAULT NULL::timestamp with time zone, p_urgency text DEFAULT 'NORMAL'::text)
 RETURNS uuid
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
DECLARE
    notification_id uuid;
BEGIN
    INSERT INTO notifications (
        user_id, title, message, notification_type, entity_type,
        entity_id, link_to, due_date, urgency, is_read, created_at, updated_at
    ) VALUES (
        p_user_id, p_title, p_message, p_notification_type, p_entity_type,
        p_entity_id, p_link_to, p_due_date, p_urgency, false,
        CURRENT_TIMESTAMP, CURRENT_TIMESTAMP
    ) RETURNING id INTO notification_id;
    RETURN notification_id;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_new_user()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
BEGIN
  INSERT INTO public.users (id, email, created_at, updated_at)
  VALUES (NEW.id, NEW.email, NOW(), NOW())
  ON CONFLICT (id) DO NOTHING;
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
 SET search_path TO 'public'
AS $function$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.update_updated_at_column()
 RETURNS trigger
 LANGUAGE plpgsql
 SET search_path TO 'public'
AS $function$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$function$
;


  create policy "Users can create their own IFTA report details"
  on "public"."ifta_report_details"
  as permissive
  for insert
  to public
with check ((EXISTS ( SELECT 1
   FROM public.ifta_reports
  WHERE ((ifta_reports.id = ifta_report_details.report_id) AND (ifta_reports.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can delete their own IFTA report details"
  on "public"."ifta_report_details"
  as permissive
  for delete
  to public
using ((EXISTS ( SELECT 1
   FROM public.ifta_reports
  WHERE ((ifta_reports.id = ifta_report_details.report_id) AND (ifta_reports.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can update their own IFTA report details"
  on "public"."ifta_report_details"
  as permissive
  for update
  to public
using ((EXISTS ( SELECT 1
   FROM public.ifta_reports
  WHERE ((ifta_reports.id = ifta_report_details.report_id) AND (ifta_reports.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can view their own IFTA report details"
  on "public"."ifta_report_details"
  as permissive
  for select
  to public
using ((EXISTS ( SELECT 1
   FROM public.ifta_reports
  WHERE ((ifta_reports.id = ifta_report_details.report_id) AND (ifta_reports.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Authenticated users can read tax rates"
  on "public"."ifta_tax_rates"
  as permissive
  for select
  to authenticated
using (true);



  create policy "Service role can manage tax rates"
  on "public"."ifta_tax_rates"
  as permissive
  for all
  to public
using ((auth.role() = 'service_role'::text))
with check ((auth.role() = 'service_role'::text));



  create policy "Users can delete invoice activities they own"
  on "public"."invoice_activities"
  as permissive
  for delete
  to public
using ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_activities.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can update invoice activities they own"
  on "public"."invoice_activities"
  as permissive
  for update
  to public
using ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_activities.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can create their own maintenance records"
  on "public"."maintenance_records"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own maintenance records"
  on "public"."maintenance_records"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own maintenance records"
  on "public"."maintenance_records"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own maintenance records"
  on "public"."maintenance_records"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own notifications"
  on "public"."notifications"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own processed sessions"
  on "public"."processed_sessions"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can insert their own processed sessions"
  on "public"."processed_sessions"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own processed sessions"
  on "public"."processed_sessions"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own trucks"
  on "public"."trucks"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own trucks"
  on "public"."trucks"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own trucks"
  on "public"."trucks"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own trucks"
  on "public"."trucks"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own profile"
  on "public"."users"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = id));



  create policy "Users can insert their own profile"
  on "public"."users"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = id));



  create policy "Users can create their own company info"
  on "public"."company_info"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own company info"
  on "public"."company_info"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own company info"
  on "public"."company_info"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own company info"
  on "public"."company_info"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "company_profiles_user_policy"
  on "public"."company_profiles"
  as permissive
  for all
  to public
using ((( SELECT auth.uid() AS uid) = user_id))
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own compliance items"
  on "public"."compliance_items"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can insert their own compliance items"
  on "public"."compliance_items"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own compliance items"
  on "public"."compliance_items"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own compliance items"
  on "public"."compliance_items"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own customers"
  on "public"."customers"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own customers"
  on "public"."customers"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own customers"
  on "public"."customers"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own customers"
  on "public"."customers"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete crossings for their own trips"
  on "public"."driver_mileage_crossings"
  as permissive
  for delete
  to public
using ((EXISTS ( SELECT 1
   FROM public.driver_mileage_trips
  WHERE ((driver_mileage_trips.id = driver_mileage_crossings.trip_id) AND (driver_mileage_trips.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can insert crossings for their own trips"
  on "public"."driver_mileage_crossings"
  as permissive
  for insert
  to public
with check ((EXISTS ( SELECT 1
   FROM public.driver_mileage_trips
  WHERE ((driver_mileage_trips.id = driver_mileage_crossings.trip_id) AND (driver_mileage_trips.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can update crossings for their own trips"
  on "public"."driver_mileage_crossings"
  as permissive
  for update
  to public
using ((EXISTS ( SELECT 1
   FROM public.driver_mileage_trips
  WHERE ((driver_mileage_trips.id = driver_mileage_crossings.trip_id) AND (driver_mileage_trips.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can view crossings for their own trips"
  on "public"."driver_mileage_crossings"
  as permissive
  for select
  to public
using ((EXISTS ( SELECT 1
   FROM public.driver_mileage_trips
  WHERE ((driver_mileage_trips.id = driver_mileage_crossings.trip_id) AND (driver_mileage_trips.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can delete their own trips"
  on "public"."driver_mileage_trips"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can insert their own trips"
  on "public"."driver_mileage_trips"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own trips"
  on "public"."driver_mileage_trips"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own trips"
  on "public"."driver_mileage_trips"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own drivers"
  on "public"."drivers"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own drivers"
  on "public"."drivers"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own drivers"
  on "public"."drivers"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own drivers"
  on "public"."drivers"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own earnings"
  on "public"."earnings"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can insert their own earnings"
  on "public"."earnings"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own earnings"
  on "public"."earnings"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own earnings"
  on "public"."earnings"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own expense categories"
  on "public"."expense_categories"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own expense categories"
  on "public"."expense_categories"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own expense categories"
  on "public"."expense_categories"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view default and their own expense categories"
  on "public"."expense_categories"
  as permissive
  for select
  to public
using (((user_id IS NULL) OR (( SELECT auth.uid() AS uid) = user_id)));



  create policy "Users can create their own expenses"
  on "public"."expenses"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own expenses"
  on "public"."expenses"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own expenses"
  on "public"."expenses"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own expenses"
  on "public"."expenses"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own fuel entries"
  on "public"."fuel_entries"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own fuel entries"
  on "public"."fuel_entries"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own fuel entries"
  on "public"."fuel_entries"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own fuel entries"
  on "public"."fuel_entries"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own IFTA reports"
  on "public"."ifta_reports"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own IFTA reports"
  on "public"."ifta_reports"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own IFTA reports"
  on "public"."ifta_reports"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own IFTA reports"
  on "public"."ifta_reports"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own IFTA trip records"
  on "public"."ifta_trip_records"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own IFTA trip records"
  on "public"."ifta_trip_records"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own IFTA trip records"
  on "public"."ifta_trip_records"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own IFTA trip records"
  on "public"."ifta_trip_records"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create IFTA trip state mileage they own"
  on "public"."ifta_trip_state_mileage"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete IFTA trip state mileage they own"
  on "public"."ifta_trip_state_mileage"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update IFTA trip state mileage they own"
  on "public"."ifta_trip_state_mileage"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view IFTA trip state mileage they own"
  on "public"."ifta_trip_state_mileage"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create invoice activities they own"
  on "public"."invoice_activities"
  as permissive
  for insert
  to public
with check ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_activities.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can view invoice activities they own"
  on "public"."invoice_activities"
  as permissive
  for select
  to public
using ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_activities.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can create invoice items they own"
  on "public"."invoice_items"
  as permissive
  for insert
  to public
with check ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_items.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can delete invoice items they own"
  on "public"."invoice_items"
  as permissive
  for delete
  to public
using ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_items.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can update invoice items they own"
  on "public"."invoice_items"
  as permissive
  for update
  to public
using ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_items.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can view invoice items they own"
  on "public"."invoice_items"
  as permissive
  for select
  to public
using ((EXISTS ( SELECT 1
   FROM public.invoices
  WHERE ((invoices.id = invoice_items.invoice_id) AND (invoices.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can create their own invoices"
  on "public"."invoices"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own invoices"
  on "public"."invoices"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own invoices"
  on "public"."invoices"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own invoices"
  on "public"."invoices"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create load documents they own"
  on "public"."load_documents"
  as permissive
  for insert
  to public
with check ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_documents.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can delete load documents they own"
  on "public"."load_documents"
  as permissive
  for delete
  to public
using ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_documents.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can update load documents they own"
  on "public"."load_documents"
  as permissive
  for update
  to public
using ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_documents.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can view load documents they own"
  on "public"."load_documents"
  as permissive
  for select
  to public
using ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_documents.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can create load stops they own"
  on "public"."load_stops"
  as permissive
  for insert
  to public
with check ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_stops.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can delete load stops they own"
  on "public"."load_stops"
  as permissive
  for delete
  to public
using ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_stops.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can update load stops they own"
  on "public"."load_stops"
  as permissive
  for update
  to public
using ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_stops.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can view load stops they own"
  on "public"."load_stops"
  as permissive
  for select
  to public
using ((EXISTS ( SELECT 1
   FROM public.loads
  WHERE ((loads.id = load_stops.load_id) AND (loads.user_id = ( SELECT auth.uid() AS uid))))));



  create policy "Users can create their own loads"
  on "public"."loads"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own loads"
  on "public"."loads"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own loads"
  on "public"."loads"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own loads"
  on "public"."loads"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "notification_preferences_user_policy"
  on "public"."notification_preferences"
  as permissive
  for all
  to public
using ((( SELECT auth.uid() AS uid) = user_id))
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own notifications"
  on "public"."notifications"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own notifications"
  on "public"."notifications"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own notifications"
  on "public"."notifications"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own payments"
  on "public"."payments"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own payments"
  on "public"."payments"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own payments"
  on "public"."payments"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own payments"
  on "public"."payments"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own processed sessions"
  on "public"."processed_sessions"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own reminders"
  on "public"."reminders"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own reminders"
  on "public"."reminders"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own reminders"
  on "public"."reminders"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own reminders"
  on "public"."reminders"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Service role can access all subscriptions"
  on "public"."subscriptions"
  as permissive
  for all
  to public
using (((( SELECT auth.jwt() AS jwt) ? 'service_role'::text) IS NOT NULL));



  create policy "Users can delete their own subscriptions"
  on "public"."subscriptions"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can insert their own subscriptions"
  on "public"."subscriptions"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own subscriptions"
  on "public"."subscriptions"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own subscriptions"
  on "public"."subscriptions"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Service role can do anything"
  on "public"."user_preferences"
  as permissive
  for all
  to public
using ((( SELECT auth.role() AS role) = 'service_role'::text));



  create policy "Users can insert their own preferences"
  on "public"."user_preferences"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own preferences"
  on "public"."user_preferences"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own preferences"
  on "public"."user_preferences"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can create their own settings"
  on "public"."user_settings"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own settings"
  on "public"."user_settings"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own settings"
  on "public"."user_settings"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own settings"
  on "public"."user_settings"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own profile"
  on "public"."users"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = id));



  create policy "Users can view their own profile"
  on "public"."users"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = id));



  create policy "Users can create their own vehicles"
  on "public"."vehicles"
  as permissive
  for insert
  to public
with check ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can delete their own vehicles"
  on "public"."vehicles"
  as permissive
  for delete
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can update their own vehicles"
  on "public"."vehicles"
  as permissive
  for update
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



  create policy "Users can view their own vehicles"
  on "public"."vehicles"
  as permissive
  for select
  to public
using ((( SELECT auth.uid() AS uid) = user_id));



